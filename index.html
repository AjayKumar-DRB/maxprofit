<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Max Profit</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            display: flex;
            flex-direction: column;
            align-items: center; /* Center align items */
        }
        table {
            margin-top: 20px;
            border-collapse: collapse;
            width: 100%; /* Full width */
            max-width: 600px; /* Max width for table */
            table-layout: fixed;/* Makes column width equal */
        }
        th, td {
            border: 1px solid #ccc;
            padding: 10px;
            text-align: center; /* Center align table content */
        }
        th {
            background-color: #f4f4f4;
        }
    </style>
</head>
<body>

    <h1>Max Profit Problem</h1>

    <form id="profitForm" onsubmit="calculate(); return false"> <!-- Stops the form from being submitted and the element is handles by javascript--> 
        <label for="timeUnits">Enter Time Units: </label>
        <input type="number" id="timeUnits" name="timeUnits" min="1" required>
        <button type="submit">Calculate</button>
    </form>

    <table id="maxProfitTable" style="display:none;">
        <thead>
            <tr>
                <th>Best Configuration</th>
                <th>Maximum Profit</th>
            </tr>
        </thead>
        <tbody id="maxProfitBody"></tbody>
    </table>

    <table id="resultTable" style="display:none;">
        <thead>
            <tr>
                <th>Configuration</th>
                <th>Profit</th>
            </tr>
        </thead>
        <tbody id="resultBody"></tbody>
    </table>

    <script>
        const properties = {
            'T': { build_time: 5, profit_per_time: 1500 },  // Theatre
            'P': { build_time: 4, profit_per_time: 1000 },  // Pub
            'C': { build_time: 10, profit_per_time: 3000 }  // Commercial Park
        };

        let formattedNodes = [];

        function calculate() {
            const timeUnits = parseInt(document.getElementById('timeUnits').value);
            formattedNodes = []; // Reset formatted nodes
            buildAllCombinations(timeUnits, { T: 0, P: 0, C: 0 }, 0);
            sortNodes(); // Sort nodes in descending order and display all combinations
        }

        function buildAllCombinations(remainingTime, counts, totalProfit) {
            if (remainingTime <= 0) {
                return;
            }

            for (const [type, { build_time, profit_per_time }] of Object.entries(properties)) {
                if (remainingTime >= build_time) {
                    const newCounts = { ...counts, [type]: counts[type] + 1 };
                    const newProfit = totalProfit + profit_per_time * (remainingTime - build_time); //Calculate total profit generated by the property in the given time span

                    const configStr = `T${newCounts.T} P${newCounts.P} C${newCounts.C}`;

                    // Store combination and profit if combination is not present in array and if more buildings can be built
                    if (!isConfigInArray(configStr, newProfit) && (remainingTime-build_time < 4)) {
                        formattedNodes.push([configStr, newProfit]);
                    } //Check if the combination is not already present

                    buildAllCombinations(remainingTime - build_time, newCounts, newProfit); //Recursive function to go through all the combinations
                }
            }
        }

        //Check if combination is already present
        function isConfigInArray(config, profit) {
            return formattedNodes.some(existingNode => 
                existingNode[0] === config && existingNode[1] === profit
            );
        }

        function sortNodes() {
            // console.log(formattedNodes)
            formattedNodes.sort((a, b) => b[1] - a[1]); // Sort by profit

            displayAllCombinations();
        }

        function displayAllCombinations() {

            const maxProfit = formattedNodes[0][1]
            
            const maxProfitTable = document.getElementById('maxProfitTable');
            const maxProfitBody = document.getElementById('maxProfitBody');
            maxProfitBody.innerHTML = ''; // Clear previous content

            const resultTable = document.getElementById('resultTable');
            const resultBody = document.getElementById('resultBody');
            resultBody.innerHTML = ''; // Clear previous content

            formattedNodes.forEach(([config, profit]) => {
                const resultRow = document.createElement('tr');
                resultRow.innerHTML = `<td>${config}</td><td>${profit}</td>`;
                resultBody.appendChild(resultRow);
            });

            formattedNodes.forEach(([config, profit]) => {
                if (profit === maxProfit) {
                    const maxProfitRow = document.createElement('tr');
                    maxProfitRow.innerHTML = `<td>${config}</td><td>${profit}</td>`;
                    maxProfitBody.appendChild(maxProfitRow);
                }
            });

            maxProfitTable.style.display = 'table'; // Show the max profit table
            resultTable.style.display = 'table'; // Show the result table
        }
    </script>

</body>
</html>
